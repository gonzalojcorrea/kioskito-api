<div class="inventory-detail-dialog">
  <!-- Encabezado -->
  <div class="dialog-header">
    <h2 mat-dialog-title class="dialog-title">
      <mat-icon class="title-icon">inventory_2</mat-icon>
      Detalle de Inventario
    </h2>
    <button mat-icon-button class="close-btn" (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="dialog-content">
    <!-- Sección de información general -->
    <mat-card class="info-card">
      <mat-card-header>
        <mat-card-title class="card-title">
          <mat-icon class="section-icon">info</mat-icon>
          Información General
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">SKU:</span>
            <span class="info-value">{{ data.inventory.sku || 'N/A' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Artículo:</span>
            <span class="info-value">{{ data.inventory.articleName }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Cantidad en Stock:</span>
            <span class="info-value highlight">{{ data.inventory.quantity }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Estado:</span>
            <span class="info-value" [ngClass]="getStatusClass(data.inventory.status)">
              {{ data.inventory.status }}
            </span>
          </div>
        </div>

        <mat-divider class="section-divider"></mat-divider>

        <!-- Precios -->
        <div class="prices-section">
          <h3 class="subsection-title">
            <mat-icon class="subsection-icon">attach_money</mat-icon>
            Precios
          </h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Última Compra:</span>
              <span class="info-value price">{{ data.inventory.lastPurchasePrice | currency:'USD':'symbol':'1.2-2' }}</span>
            </div>
            <div class="info-item" *ngIf="data.inventory.salePrice">
              <span class="info-label">Precio Venta:</span>
              <span class="info-value price">{{ data.inventory.salePrice | currency:'USD':'symbol':'1.2-2' }}</span>
            </div>
            <div class="info-item" *ngIf="data.inventory.consignmentPrice">
              <span class="info-label">Precio Consignación:</span>
              <span class="info-value price">{{ data.inventory.consignmentPrice | currency:'USD':'symbol':'1.2-2' }}</span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Sección de transacciones -->
    <mat-card class="transactions-card">
      <mat-card-header>
        <mat-card-title class="card-title">
          <mat-icon class="section-icon">receipt_long</mat-icon>
          Historial de Transacciones
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="loading" class="loading-container">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Cargando transacciones...</p>
        </div>

        <div *ngIf="!loading && transactions.length === 0" class="no-data">
          <mat-icon class="no-data-icon">info</mat-icon>
          <p>No hay transacciones registradas para este inventario</p>
        </div>

        <div *ngIf="!loading && transactions.length > 0" class="table-container">
          <table mat-table [dataSource]="transactions" class="transactions-table">
            
            <!-- Fecha -->
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Fecha</th>
              <td mat-cell *matCellDef="let transaction">{{ transaction.date | date:'dd/MM/yyyy HH:mm' }}</td>
            </ng-container>

            <!-- Tipo -->
            <ng-container matColumnDef="transactionType">
              <th mat-header-cell *matHeaderCellDef>Tipo</th>
              <td mat-cell *matCellDef="let transaction">
                <span class="transaction-type" [ngClass]="getTransactionTypeClass(transaction.transactionType)">
                  {{ transaction.transactionType }}
                </span>
              </td>
            </ng-container>

            <!-- Cantidad -->
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef class="text-right">Cantidad</th>
              <td mat-cell *matCellDef="let transaction" class="text-right">
                {{ transaction.quantity }}
              </td>
            </ng-container>

            <!-- Costo Unitario -->
            <ng-container matColumnDef="unitCost">
              <th mat-header-cell *matHeaderCellDef class="text-right">Costo Unitario</th>
              <td mat-cell *matCellDef="let transaction" class="text-right">
                {{ transaction.unitCost | currency:'USD':'symbol':'1.2-2' }}
              </td>
            </ng-container>

            <!-- Total -->
            <ng-container matColumnDef="totalAmount">
              <th mat-header-cell *matHeaderCellDef class="text-right">Total</th>
              <td mat-cell *matCellDef="let transaction" class="text-right total-amount">
                {{ getTotalAmount(transaction) | currency:'USD':'symbol':'1.2-2' }}
              </td>
            </ng-container>

            <!-- Usuario -->
            <ng-container matColumnDef="userName">
              <th mat-header-cell *matHeaderCellDef>Usuario</th>
              <td mat-cell *matCellDef="let transaction">
                {{ transaction.userName }}
              </td>
            </ng-container>

            <!-- Notas -->
            <ng-container matColumnDef="note">
              <th mat-header-cell *matHeaderCellDef>Notas</th>
              <td mat-cell *matCellDef="let transaction">
                {{ transaction.note || '-' }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="dialog-actions">
    <button mat-flat-button color="primary" (click)="close()">
      <mat-icon>check</mat-icon>
      Cerrar
    </button>
  </mat-dialog-actions>
</div>
