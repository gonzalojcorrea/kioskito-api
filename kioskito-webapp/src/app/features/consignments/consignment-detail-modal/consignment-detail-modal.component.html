<div class="consignment-detail-dialog">
  <!-- Encabezado -->
  <div class="dialog-header">
    <h2 mat-dialog-title class="dialog-title">
      <mat-icon class="title-icon">receipt_long</mat-icon>
      Detalle de Consignación
    </h2>
    <button mat-icon-button class="close-btn" (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="dialog-content">
    <div *ngIf="loading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando información...</p>
    </div>

    <div *ngIf="!loading && consignmentDetail">
      <!-- Sección de información general -->
      <mat-card class="info-card">
        <mat-card-header>
          <mat-card-title class="card-title">
            <mat-icon class="section-icon">info</mat-icon>
            Información General
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Cliente/Negocio:</span>
              <span class="info-value">{{ consignmentDetail.customerName }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Email:</span>
              <span class="info-value">{{ consignmentDetail.customerEmail }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Teléfono:</span>
              <span class="info-value">{{ consignmentDetail.customerPhone }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Fecha Inicio:</span>
              <span class="info-value">{{ consignmentDetail.startDate | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="info-item" *ngIf="consignmentDetail.endDate">
              <span class="info-label">Fecha Finalización:</span>
              <span class="info-value">{{ consignmentDetail.endDate | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Estado:</span>
              <span class="info-value" [ngClass]="getStatusClass(consignmentDetail.status)">
                {{ consignmentDetail.status }}
              </span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Sección de artículos -->
      <mat-card class="items-card">
        <mat-card-header>
          <mat-card-title class="card-title">
            <mat-icon class="section-icon">shopping_cart</mat-icon>
            Artículos Consignados
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="consignmentDetail.lines.length === 0" class="no-data">
            <mat-icon class="no-data-icon">info</mat-icon>
            <p>No hay artículos en esta consignación</p>
          </div>

          <div *ngIf="consignmentDetail.lines.length > 0" class="table-container">
            <table mat-table [dataSource]="consignmentDetail.lines" class="items-table">
              
              <!-- SKU -->
              <ng-container matColumnDef="sku">
                <th mat-header-cell *matHeaderCellDef>SKU</th>
                <td mat-cell *matCellDef="let item">{{ item.articleSku || '-' }}</td>
              </ng-container>

              <!-- Artículo -->
              <ng-container matColumnDef="articleName">
                <th mat-header-cell *matHeaderCellDef>Artículo</th>
                <td mat-cell *matCellDef="let item">{{ item.articleName }}</td>
              </ng-container>

              <!-- Entregado -->
              <ng-container matColumnDef="deliveredQty">
                <th mat-header-cell *matHeaderCellDef class="text-right">Entregado</th>
                <td mat-cell *matCellDef="let item" class="text-right">
                  <strong>{{ item.deliveredQty }}</strong>
                </td>
              </ng-container>

              <!-- Devuelto -->
              <ng-container matColumnDef="returnedQty">
                <th mat-header-cell *matHeaderCellDef class="text-right">Devuelto</th>
                <td mat-cell *matCellDef="let item" class="text-right">
                  {{ item.returnedQty }}
                </td>
              </ng-container>

              <!-- Vendido -->
              <ng-container matColumnDef="soldQty">
                <th mat-header-cell *matHeaderCellDef class="text-right">Vendido</th>
                <td mat-cell *matCellDef="let item" class="text-right">
                  {{ item.soldQty }}
                </td>
              </ng-container>

              <!-- Precio Unitario -->
              <ng-container matColumnDef="unitPrice">
                <th mat-header-cell *matHeaderCellDef class="text-right">P. Unitario</th>
                <td mat-cell *matCellDef="let item" class="text-right price-highlight">
                  {{ item.unitPrice | currency:'USD':'symbol':'1.2-2' }}
                </td>
              </ng-container>

              <!-- Total -->
              <ng-container matColumnDef="lineTotal">
                <th mat-header-cell *matHeaderCellDef class="text-right">Total</th>
                <td mat-cell *matCellDef="let item" class="text-right total-amount">
                  {{ item.lineTotal | currency:'USD':'symbol':'1.2-2' }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>

          <!-- Total -->
          <div class="total-section">
            <div class="total-label">Total Consignación:</div>
            <div class="total-value">{{ consignmentDetail.total | currency:'USD':'symbol':'1.2-2' }}</div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <div *ngIf="!loading && !consignmentDetail" class="error-container">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <p>No se pudo cargar la información de la consignación</p>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="dialog-actions">
    <button mat-flat-button color="primary" (click)="close()">
      <mat-icon>check</mat-icon>
      Cerrar
    </button>
  </mat-dialog-actions>
</div>
